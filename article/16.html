<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><title>Race condition ë°œìƒì‹œí‚¤ê³  Mutex lockìœ¼ë¡œ í•´ê²°í•˜ê¸°</title><meta name="viewport"content="width=device-width,initial-scale=1"><meta http-equiv="X-UA-Compatible"content="ie=edge"><meta name="theme-color"content="#F5F5F5"><meta name="description"content="race conditionì€ ë‘ ê°œ ì´ìƒì˜ í”„ë¡œì„¸ìŠ¤ë‚˜ ìŠ¤ë ˆë“œê°€ í•˜ë‚˜ì˜ ë°ì´í„°ë¥¼ ê³µìœ í•  ë•Œ ë°ì´í„°ê°€ ë™ê¸°í™”ë˜ì§€ ì•ŠëŠ” ìƒí™©ì„ ë§í•œë‹¤. (ê³µë£¡ì±…ìœ¼ë¡œ ì •ë¦¬í•˜ëŠ” ìš´ì˜ì²´ì œ Ch.6ì— ì •ë¦¬í–ˆë‹¤.) ê·¸ë¦¬ê³  ì½”ë“œì—ì„œ ì´ëŸ¬í•œ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë¶€ë¶„ì„ critical sectionì´ë¼ê³  í•˜ë©°, ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ í•œ ë²ˆì— í•˜ë‚˜ì˜ ..."><link rel="canonical"href="https://parksb.github.io/article/16.html"><meta name="fediverse:creator"content="@parksb@silicon.moe"><meta property="og:title"content="Race condition ë°œìƒì‹œí‚¤ê³  Mutex lockìœ¼ë¡œ í•´ê²°í•˜ê¸°"><meta property="og:image"content="https://og-image-parksb.vercel.app/api/parksb-github-io?title=Race%20condition%20%EB%B0%9C%EC%83%9D%EC%8B%9C%ED%82%A4%EA%B3%A0%20Mutex%20lock%EC%9C%BC%EB%A1%9C%20%ED%95%B4%EA%B2%B0%ED%95%98%EA%B8%B0&subtitle=&date=2018.06.11"><meta property="og:description"content="race conditionì€ ë‘ ê°œ ì´ìƒì˜ í”„ë¡œì„¸ìŠ¤ë‚˜ ìŠ¤ë ˆë“œê°€ í•˜ë‚˜ì˜ ë°ì´í„°ë¥¼ ê³µìœ í•  ë•Œ ë°ì´í„°ê°€ ë™ê¸°í™”ë˜ì§€ ì•ŠëŠ” ìƒí™©ì„ ë§í•œë‹¤. (ê³µë£¡ì±…ìœ¼ë¡œ ì •ë¦¬í•˜ëŠ” ìš´ì˜ì²´ì œ Ch.6ì— ì •ë¦¬í–ˆë‹¤.) ê·¸ë¦¬ê³  ì½”ë“œì—ì„œ ì´ëŸ¬í•œ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë¶€ë¶„ì„ critical sectionì´ë¼ê³  í•˜ë©°, ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ í•œ ë²ˆì— í•˜ë‚˜ì˜ ..."><meta name="twitter:title"content="Race condition ë°œìƒì‹œí‚¤ê³  Mutex lockìœ¼ë¡œ í•´ê²°í•˜ê¸°"><meta name="twitter:image"content="https://og-image-parksb.vercel.app/api/parksb-github-io?title=Race%20condition%20%EB%B0%9C%EC%83%9D%EC%8B%9C%ED%82%A4%EA%B3%A0%20Mutex%20lock%EC%9C%BC%EB%A1%9C%20%ED%95%B4%EA%B2%B0%ED%95%98%EA%B8%B0&subtitle=&date=2018.06.11"><meta name="twitter:description"content="race conditionì€ ë‘ ê°œ ì´ìƒì˜ í”„ë¡œì„¸ìŠ¤ë‚˜ ìŠ¤ë ˆë“œê°€ í•˜ë‚˜ì˜ ë°ì´í„°ë¥¼ ê³µìœ í•  ë•Œ ë°ì´í„°ê°€ ë™ê¸°í™”ë˜ì§€ ì•ŠëŠ” ìƒí™©ì„ ë§í•œë‹¤. (ê³µë£¡ì±…ìœ¼ë¡œ ì •ë¦¬í•˜ëŠ” ìš´ì˜ì²´ì œ Ch.6ì— ì •ë¦¬í–ˆë‹¤.) ê·¸ë¦¬ê³  ì½”ë“œì—ì„œ ì´ëŸ¬í•œ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë¶€ë¶„ì„ critical sectionì´ë¼ê³  í•˜ë©°, ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ í•œ ë²ˆì— í•˜ë‚˜ì˜ ..."><meta name="twitter:card"content="summary_large_image"><link rel="shortcut icon"href="../assets/favicon.ico"type="image/x-icon"><link rel="preload"href="https://cdn.jsdelivr.net/gh/parksb/cdn@master/font/Pretendard/woff2/Pretendard-VF-Distilled.woff2"as="font"type="font/woff2"crossorigin><link rel="preload"href="https://cdn.jsdelivr.net/gh/parksb/cdn@master/font/RobotoMono/woff2/RobotoMono-VF-Distilled.woff2"as="font"type="font/woff2"crossorigin><style>@font-face { font-family: 'Pretendard'; src: url('https://cdn.jsdelivr.net/gh/parksb/cdn@master/font/Pretendard/woff2/Pretendard-VF-Distilled.woff2'), local('Pretendard') format('woff2'); font-display: swap; }
      @font-face { font-family: 'RobotoMono'; src: local('RobotoMono'), url('https://cdn.jsdelivr.net/gh/parksb/cdn@master/font/RobotoMono/woff2/RobotoMono-VF-Distilled.woff2') format('woff2'); font-display: swap; }
      a:hover { color: #005ccc !important; }
      #article-content-container a:hover, #article-content-container a:focus { text-decoration: underline !important; }
      #article-content-container .table-of-contents ul li:before { content: counters(item, ".") ". "; counter-increment: item; }
      #article-content-container .footnotes > .footnotes-list > .footnote-item > span { font-size: 0.9rem; }</style></head><body style="font-family: Pretendard,sans-serif; font-size: 16px; margin: 0; padding: 20px 30px 50px 30px; word-break: keep-all;"><header id="top-container"role="navigation"><nav><a class="special-anchor"href="/"style="color: #000; text-decoration: none; cursor: pointer;"><span class="t1"style="font-size: 1.5rem; font-weight: 800;">ë°•ì„±ë²”</span> <span class="t2"style="font-size: 1rem; font-weight: 400;">Simon Park</span></a></nav></header><main id="main-container"style="max-width: 800px; margin-top: 30px; margin-bottom: 30px;"><article id="article-container"><div class="back-to-article-list"style="font-size: 1rem; margin-bottom: 1rem;"><a href="../articles.html"style="color: #000; text-decoration: none; cursor: pointer;"><span class="symbol"style="font-family: Pretendard,sans-serif;">â†</span> Articles</a></div><h1 id="article-title"style="margin: 0; padding: 0; font-size: 1.5rem; font-weight: 700;">Race condition ë°œìƒì‹œí‚¤ê³  Mutex lockìœ¼ë¡œ í•´ê²°í•˜ê¸°</h1><a href="https://github.com/parksb/parksb.github.io/commits/development/_articles/20180611_resolving-race-condition-using-mutex.md"style="color: #000; text-decoration: none; cursor: pointer;"><time id="article-date"style="font-family: RobotoMono,monospace; font-size: .8rem;">2018.06.11<span class="symbol"style="font-family: Pretendard,sans-serif;">â†—</span></time></a><section id="article-content-container"style="margin-top: 30px;"><details style="margin: 0; padding: 0; display: inline; margin-bottom: 10px;"><summary style="font-weight: 700; cursor: pointer;">Table of Contents</summary><p style="font-size: 1rem; line-height: 1.7rem; margin-bottom: 1rem;"></p><div class="table-of-contents"style="font-size: 15px;"><ul style="padding: 0; margin-left: 2rem; list-style-type: none; counter-reset: item; margin: 0; padding-left: 1rem;"></ul></div><p style="font-size: 1rem; line-height: 1.7rem; margin-bottom: 1rem;"></p></details><p style="font-size: 1rem; line-height: 1.7rem; margin-bottom: 1rem;">race conditionì€ ë‘ ê°œ ì´ìƒì˜ í”„ë¡œì„¸ìŠ¤ë‚˜ ìŠ¤ë ˆë“œê°€ í•˜ë‚˜ì˜ ë°ì´í„°ë¥¼ ê³µìœ í•  ë•Œ ë°ì´í„°ê°€ ë™ê¸°í™”ë˜ì§€ ì•ŠëŠ” ìƒí™©ì„ ë§í•œë‹¤. (<a href="https://parksb.github.io/article/10.html"style="text-decoration: none; cursor: pointer; color: #005ccc;">ê³µë£¡ì±…ìœ¼ë¡œ ì •ë¦¬í•˜ëŠ” ìš´ì˜ì²´ì œ Ch.6</a>ì— ì •ë¦¬í–ˆë‹¤.) ê·¸ë¦¬ê³  ì½”ë“œì—ì„œ ì´ëŸ¬í•œ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë¶€ë¶„ì„ critical sectionì´ë¼ê³  í•˜ë©°, ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ í•œ ë²ˆì— í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œë§Œ critical sectionì— ì§„ì…í•  ìˆ˜ ìˆë„ë¡ ì œì–´í•˜ëŠ” ê¸°ë²•ì„ mutex lockì´ë¼ê³  í•œë‹¤.</p><p style="font-size: 1rem; line-height: 1.7rem; margin-bottom: 1rem;">CentOSì—ì„œ 3ê°œì˜ ìŠ¤ë ˆë“œë¥¼ ìš´ì˜í•˜ëŠ” í”„ë¡œê·¸ë¨ì„ ì§œê³ , race conditionì„ ë°œìƒì‹œí‚¨ ë’¤ mutex lockì„ í†µí•´ í•´ê²°í•´ë³´ë ¤ í•œë‹¤. ë¨¼ì € 3ê°œì˜ ìŠ¤ë ˆë“œë¥¼ ë§Œë“¤ì–´ë³´ì.</p><pre class="shiki github-light"style="display: block; overflow-x: auto; padding-left: 1rem; margin-bottom: 1rem; line-height: 1.3rem; background-color: #fff; color: #24292e;"tabindex="0"><code class="language-c"style="font-family: RobotoMono,monospace;"><span class="line"><span style="color:#D73A49">#include</span><span style="color:#032F62"> &#x3C;stdio.h></span></span>
<span class="line"><span style="color:#D73A49">#include</span><span style="color:#032F62"> &#x3C;pthread.h></span></span>
<span class="line"><span style="color:#D73A49">#include</span><span style="color:#032F62"> &#x3C;time.h></span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">void*</span><span style="color:#6F42C1"> performThread</span><span style="color:#24292E">(</span><span style="color:#D73A49">void*</span><span style="color:#E36209"> data</span><span style="color:#24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">int</span><span style="color:#24292E"> count </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">int</span><span style="color:#6F42C1"> main</span><span style="color:#24292E">(</span><span style="color:#D73A49">int</span><span style="color:#E36209"> argc</span><span style="color:#24292E">, </span><span style="color:#D73A49">char*</span><span style="color:#E36209"> argv</span><span style="color:#D73A49">[]</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">  pthread_t</span><span style="color:#E36209"> threads</span><span style="color:#24292E">[</span><span style="color:#005CC5">3</span><span style="color:#24292E">];</span></span>
<span class="line"><span style="color:#D73A49">  char</span><span style="color:#E36209"> threadNames</span><span style="color:#24292E">[</span><span style="color:#005CC5">3</span><span style="color:#24292E">][</span><span style="color:#005CC5">128</span><span style="color:#24292E">] </span><span style="color:#D73A49">=</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    {</span><span style="color:#032F62">"thread1"</span><span style="color:#24292E">},</span></span>
<span class="line"><span style="color:#24292E">    {</span><span style="color:#032F62">"thread2"</span><span style="color:#24292E">},</span></span>
<span class="line"><span style="color:#24292E">    {</span><span style="color:#032F62">"thread3"</span><span style="color:#24292E">}</span></span>
<span class="line"><span style="color:#24292E">  };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">  pthread_create</span><span style="color:#24292E">(</span><span style="color:#D73A49">&#x26;</span><span style="color:#E36209">threads</span><span style="color:#24292E">[</span><span style="color:#005CC5">0</span><span style="color:#24292E">], </span><span style="color:#005CC5">NULL</span><span style="color:#24292E">, performThread, (</span><span style="color:#D73A49">void*</span><span style="color:#24292E">)</span><span style="color:#E36209">threadNames</span><span style="color:#24292E">[</span><span style="color:#005CC5">0</span><span style="color:#24292E">]);</span></span>
<span class="line"><span style="color:#6F42C1">  pthread_create</span><span style="color:#24292E">(</span><span style="color:#D73A49">&#x26;</span><span style="color:#E36209">threads</span><span style="color:#24292E">[</span><span style="color:#005CC5">1</span><span style="color:#24292E">], </span><span style="color:#005CC5">NULL</span><span style="color:#24292E">, performThread, (</span><span style="color:#D73A49">void*</span><span style="color:#24292E">)</span><span style="color:#E36209">threadNames</span><span style="color:#24292E">[</span><span style="color:#005CC5">1</span><span style="color:#24292E">]);</span></span>
<span class="line"><span style="color:#6F42C1">  pthread_create</span><span style="color:#24292E">(</span><span style="color:#D73A49">&#x26;</span><span style="color:#E36209">threads</span><span style="color:#24292E">[</span><span style="color:#005CC5">2</span><span style="color:#24292E">], </span><span style="color:#005CC5">NULL</span><span style="color:#24292E">, performThread, (</span><span style="color:#D73A49">void*</span><span style="color:#24292E">)</span><span style="color:#E36209">threadNames</span><span style="color:#24292E">[</span><span style="color:#005CC5">2</span><span style="color:#24292E">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">  printf</span><span style="color:#24292E">(</span><span style="color:#032F62">"</span><span style="color:#005CC5">%d\n</span><span style="color:#032F62">"</span><span style="color:#24292E">, count);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">  return</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">void*</span><span style="color:#6F42C1"> performThread</span><span style="color:#24292E">(</span><span style="color:#D73A49">void*</span><span style="color:#E36209"> data</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">  count</span><span style="color:#D73A49">++</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre><p style="font-size: 1rem; line-height: 1.7rem; margin-bottom: 1rem;">3ê°œì˜ ìŠ¤ë ˆë“œê°€ ì°¨ë¡€ëŒ€ë¡œ <code style="font-family: RobotoMono,monospace;">count</code>ë¥¼ ì¦ê°€ì‹œì¼°ê¸° ë•Œë¬¸ì— ì˜ˆìƒëŒ€ë¡œ ê²°ê³¼ëŠ” 3ì´ ë‚˜ì˜¨ë‹¤. ì´ê±¸ ì¡°ê¸ˆ ë°”ê¿”ì„œ <code style="font-family: RobotoMono,monospace;">count</code>ë¥¼ 10ë§Œë²ˆ ì¦ê°€ì‹œí‚¤ê³ , ëª¨ë“  ë‚´ìš©ì„ ë¡œê·¸ì— ë‚¨ê¸°ë„ë¡ í•˜ë ¤í•œë‹¤. <code style="font-family: RobotoMono,monospace;">performThread</code>ë§Œ ìˆ˜ì •í•´ì£¼ë©´ ëœë‹¤.</p><pre class="shiki github-light"style="display: block; overflow-x: auto; padding-left: 1rem; margin-bottom: 1rem; line-height: 1.3rem; background-color: #fff; color: #24292e;"tabindex="0"><code class="language-c"style="font-family: RobotoMono,monospace;"><span class="line"><span style="color:#D73A49">void*</span><span style="color:#6F42C1"> performThread</span><span style="color:#24292E">(</span><span style="color:#D73A49">void*</span><span style="color:#E36209"> data</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">  time_t</span><span style="color:#24292E"> currentTime;</span></span>
<span class="line"><span style="color:#D73A49">  struct</span><span style="color:#24292E"> tm</span><span style="color:#D73A49">*</span><span style="color:#24292E"> timeInfo;</span></span>
<span class="line"><span style="color:#D73A49">  char</span><span style="color:#E36209"> currentTimeString</span><span style="color:#24292E">[</span><span style="color:#005CC5">128</span><span style="color:#24292E">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">  char*</span><span style="color:#24292E"> threadName </span><span style="color:#D73A49">=</span><span style="color:#24292E"> (</span><span style="color:#D73A49">char*</span><span style="color:#24292E">)data;</span></span>
<span class="line"><span style="color:#24292E">  FILE</span><span style="color:#D73A49">*</span><span style="color:#24292E"> file;</span></span>
<span class="line"><span style="color:#D73A49">  int</span><span style="color:#24292E"> i </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  file </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> fopen</span><span style="color:#24292E">(</span><span style="color:#032F62">"event.log"</span><span style="color:#24292E">, </span><span style="color:#032F62">"a"</span><span style="color:#24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">  for</span><span style="color:#24292E"> (i </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">; i </span><span style="color:#D73A49">&#x3C;</span><span style="color:#005CC5"> 100000</span><span style="color:#24292E">; i</span><span style="color:#D73A49">++</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#6F42C1">    time</span><span style="color:#24292E">(</span><span style="color:#D73A49">&#x26;</span><span style="color:#24292E">currentTime);</span></span>
<span class="line"><span style="color:#24292E">    timeInfo </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> localtime</span><span style="color:#24292E">(</span><span style="color:#D73A49">&#x26;</span><span style="color:#24292E">currentTime);</span></span>
<span class="line"><span style="color:#6F42C1">    strftime</span><span style="color:#24292E">(currentTimeString, </span><span style="color:#005CC5">128</span><span style="color:#24292E">, </span><span style="color:#032F62">"</span><span style="color:#B31D28;font-style:italic">%</span><span style="color:#032F62">Y-</span><span style="color:#B31D28;font-style:italic">%</span><span style="color:#032F62">m-</span><span style="color:#005CC5">%d</span><span style="color:#B31D28;font-style:italic"> %</span><span style="color:#032F62">H:</span><span style="color:#B31D28;font-style:italic">%</span><span style="color:#032F62">M:</span><span style="color:#005CC5">%S</span><span style="color:#032F62">"</span><span style="color:#24292E">, timeInfo);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    fprintf</span><span style="color:#24292E">(file, </span><span style="color:#032F62">"</span><span style="color:#005CC5">%s\t%s\t%d\n</span><span style="color:#032F62">"</span><span style="color:#24292E">, currentTimeString, threadName, count);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    count</span><span style="color:#D73A49">++</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">  fclose</span><span style="color:#24292E">(file);</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre><p style="font-size: 1rem; line-height: 1.7rem; margin-bottom: 1rem;">ë°˜ë³µë¬¸ì„ 10ë§Œë²ˆ ëŒë©´ì„œ ì‹œê°„, ìŠ¤ë ˆë“œ ì´ë¦„, <code style="font-family: RobotoMono,monospace;">count</code> ìˆœì„œë¡œ ë¡œê·¸ë¥¼ í•œ ì¤„ì”© ë‚¨ê¸°ë„ë¡ ìˆ˜ì •í•˜ê³  ì‹¤í–‰í•œë‹¤.</p><p style="font-size: 1rem; line-height: 1.7rem; margin-bottom: 1rem;"><img src="/images/50655469-a575fd00-0fd3-11e9-86c4-54add9d239f4.webp"alt decoding="async"width="186"height="379"style="max-width: 100%; height: auto; margin-bottom: -7px;"></p><p style="font-size: 1rem; line-height: 1.7rem; margin-bottom: 1rem;">ì—„ì²­ë‚œ ë¹ˆë„ë¡œ race conditionì´ ë°œìƒí–ˆìœ¼ë©°, ìµœì¢… ê²°ê³¼ê°€ ì •í™•íˆ 300000ìœ¼ë¡œ ë–¨ì–´ì§€ì§€ ì•Šì•˜ë‹¤. ì´ì— ì•ì„œ VMì—ì„œ í…ŒìŠ¤íŠ¸í•˜ë©´ì„œ race conditionì´ ì¼ì–´ë‚˜ì§€ ì•Šì•„ ì‚½ì§ˆì„ ë§ì´ í–ˆëŠ”ë°, VMì„ ì‹±ê¸€ ì½”ì–´ë¡œ ì„¤ì •í•´ì„œ ê·¸ëŸ° ê²ƒì´ì—ˆë‹¤.</p><p style="font-size: 1rem; line-height: 1.7rem; margin-bottom: 1rem;"><img src="/images/50655465-a3ac3980-0fd3-11e9-856b-a5f67445bb09.webp"alt loading="lazy"decoding="async"width="800"height="613"style="max-width: 100%; height: auto; margin-bottom: -7px;"></p><p style="font-size: 1rem; line-height: 1.7rem; margin-bottom: 1rem;">ìœ„ì™€ ê°™ì´ ì‹±ê¸€ ì½”ì–´ í™˜ê²½ì—ì„œëŠ” í•œ ë²ˆì— í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œë§Œ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì— race conditionì´ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.</p><p style="font-size: 1rem; line-height: 1.7rem; margin-bottom: 1rem;">ë‹¤ì‹œ ë©€í‹° ì½”ì–´ í™˜ê²½ìœ¼ë¡œ ëŒì•„ì™€ì„œ, race conditionì„ mutex lockìœ¼ë¡œ í•´ê²°í•´ë³¸ë‹¤.</p><pre class="shiki github-light"style="display: block; overflow-x: auto; padding-left: 1rem; margin-bottom: 1rem; line-height: 1.3rem; background-color: #fff; color: #24292e;"tabindex="0"><code class="language-c"style="font-family: RobotoMono,monospace;"><span class="line"><span style="color:#D73A49">#include</span><span style="color:#032F62"> &#x3C;stdio.h></span></span>
<span class="line"><span style="color:#D73A49">#include</span><span style="color:#032F62"> &#x3C;pthread.h></span></span>
<span class="line"><span style="color:#D73A49">#include</span><span style="color:#032F62"> &#x3C;time.h></span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">void*</span><span style="color:#6F42C1"> performThread</span><span style="color:#24292E">(</span><span style="color:#D73A49">void*</span><span style="color:#E36209"> data</span><span style="color:#24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">pthread_mutex_t</span><span style="color:#24292E"> mutex </span><span style="color:#D73A49">=</span><span style="color:#24292E"> PTHREAD_MUTEX_INITIALIZER;</span></span>
<span class="line"><span style="color:#D73A49">int</span><span style="color:#24292E"> counter </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">FILE</span><span style="color:#D73A49">*</span><span style="color:#24292E"> file;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">int</span><span style="color:#6F42C1"> main</span><span style="color:#24292E">(</span><span style="color:#D73A49">int</span><span style="color:#E36209"> argc</span><span style="color:#24292E">, </span><span style="color:#D73A49">char*</span><span style="color:#E36209"> argv</span><span style="color:#D73A49">[]</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">  pthread_t</span><span style="color:#E36209"> threads</span><span style="color:#24292E">[</span><span style="color:#005CC5">3</span><span style="color:#24292E">];</span></span>
<span class="line"><span style="color:#D73A49">  char</span><span style="color:#E36209"> threadNames</span><span style="color:#24292E">[</span><span style="color:#005CC5">3</span><span style="color:#24292E">][</span><span style="color:#005CC5">128</span><span style="color:#24292E">] </span><span style="color:#D73A49">=</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    {</span><span style="color:#032F62">"thread1"</span><span style="color:#24292E">},</span></span>
<span class="line"><span style="color:#24292E">    {</span><span style="color:#032F62">"thread2"</span><span style="color:#24292E">},</span></span>
<span class="line"><span style="color:#24292E">    {</span><span style="color:#032F62">"thread3"</span><span style="color:#24292E">}</span></span>
<span class="line"><span style="color:#24292E">  };</span></span>
<span class="line"><span style="color:#D73A49">  int</span><span style="color:#24292E"> i </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  file </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> fopen</span><span style="color:#24292E">(</span><span style="color:#032F62">"event.log"</span><span style="color:#24292E">, </span><span style="color:#032F62">"a"</span><span style="color:#24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">  for</span><span style="color:#24292E"> (i </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">; i </span><span style="color:#D73A49">&#x3C;</span><span style="color:#005CC5"> 100000</span><span style="color:#24292E">; i</span><span style="color:#D73A49">++</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#6F42C1">    pthread_create</span><span style="color:#24292E">(</span><span style="color:#D73A49">&#x26;</span><span style="color:#E36209">threads</span><span style="color:#24292E">[</span><span style="color:#005CC5">0</span><span style="color:#24292E">], </span><span style="color:#005CC5">NULL</span><span style="color:#24292E">, performThread, (</span><span style="color:#D73A49">void*</span><span style="color:#24292E">)</span><span style="color:#E36209">threadNames</span><span style="color:#24292E">[</span><span style="color:#005CC5">0</span><span style="color:#24292E">]);</span></span>
<span class="line"><span style="color:#6F42C1">    pthread_create</span><span style="color:#24292E">(</span><span style="color:#D73A49">&#x26;</span><span style="color:#E36209">threads</span><span style="color:#24292E">[</span><span style="color:#005CC5">1</span><span style="color:#24292E">], </span><span style="color:#005CC5">NULL</span><span style="color:#24292E">, performThread, (</span><span style="color:#D73A49">void*</span><span style="color:#24292E">)</span><span style="color:#E36209">threadNames</span><span style="color:#24292E">[</span><span style="color:#005CC5">1</span><span style="color:#24292E">]);</span></span>
<span class="line"><span style="color:#6F42C1">    pthread_create</span><span style="color:#24292E">(</span><span style="color:#D73A49">&#x26;</span><span style="color:#E36209">threads</span><span style="color:#24292E">[</span><span style="color:#005CC5">2</span><span style="color:#24292E">], </span><span style="color:#005CC5">NULL</span><span style="color:#24292E">, performThread, (</span><span style="color:#D73A49">void*</span><span style="color:#24292E">)</span><span style="color:#E36209">threadNames</span><span style="color:#24292E">[</span><span style="color:#005CC5">2</span><span style="color:#24292E">]);</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">  printf</span><span style="color:#24292E">(</span><span style="color:#032F62">"Done: </span><span style="color:#005CC5">%d\n</span><span style="color:#032F62">"</span><span style="color:#24292E">, counter);</span></span>
<span class="line"><span style="color:#6F42C1">  fclose</span><span style="color:#24292E">(file);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">  return</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">void*</span><span style="color:#6F42C1"> performThread</span><span style="color:#24292E">(</span><span style="color:#D73A49">void*</span><span style="color:#E36209"> data</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#6F42C1">  pthread_mutex_lock</span><span style="color:#24292E">(</span><span style="color:#D73A49">&#x26;</span><span style="color:#24292E">mutex);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">  time_t</span><span style="color:#24292E"> currentTime;</span></span>
<span class="line"><span style="color:#D73A49">  struct</span><span style="color:#24292E"> tm</span><span style="color:#D73A49">*</span><span style="color:#24292E"> timeInfo;</span></span>
<span class="line"><span style="color:#D73A49">  char</span><span style="color:#E36209"> currentTimeString</span><span style="color:#24292E">[</span><span style="color:#005CC5">128</span><span style="color:#24292E">];</span></span>
<span class="line"><span style="color:#D73A49">  char*</span><span style="color:#24292E"> threadName </span><span style="color:#D73A49">=</span><span style="color:#24292E"> (</span><span style="color:#D73A49">char*</span><span style="color:#24292E">)data;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">  time</span><span style="color:#24292E">(</span><span style="color:#D73A49">&#x26;</span><span style="color:#24292E">currentTime);</span></span>
<span class="line"><span style="color:#24292E">  timeInfo </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> localtime</span><span style="color:#24292E">(</span><span style="color:#D73A49">&#x26;</span><span style="color:#24292E">currentTime);</span></span>
<span class="line"><span style="color:#6F42C1">  strftime</span><span style="color:#24292E">(currentTimeString, </span><span style="color:#005CC5">128</span><span style="color:#24292E">, </span><span style="color:#032F62">"</span><span style="color:#B31D28;font-style:italic">%</span><span style="color:#032F62">Y-</span><span style="color:#B31D28;font-style:italic">%</span><span style="color:#032F62">m-</span><span style="color:#005CC5">%d</span><span style="color:#B31D28;font-style:italic"> %</span><span style="color:#032F62">H:</span><span style="color:#B31D28;font-style:italic">%</span><span style="color:#032F62">M:</span><span style="color:#005CC5">%S</span><span style="color:#032F62">"</span><span style="color:#24292E">, timeInfo);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">  fprintf</span><span style="color:#24292E">(file, </span><span style="color:#032F62">"</span><span style="color:#005CC5">%s\t%s\t%d\n</span><span style="color:#032F62">"</span><span style="color:#24292E">, currentTimeString, threadName, counter);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  counter</span><span style="color:#D73A49">++</span><span style="color:#24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">  pthread_mutex_unlock</span><span style="color:#24292E">(</span><span style="color:#D73A49">&#x26;</span><span style="color:#24292E">mutex);</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre><p style="font-size: 1rem; line-height: 1.7rem; margin-bottom: 1rem;">ë¨¼ì € <code style="font-family: RobotoMono,monospace;">mutex</code> ë³€ìˆ˜ë¥¼ ë§Œë“¤ì—ˆë‹¤. ê·¸ë¦¬ê³  critical sectionì€ <code style="font-family: RobotoMono,monospace;">performThread</code> í•¨ìˆ˜ì—ì„œ ë¡œê·¸ë¥¼ ë‚¨ê¸°ê³  <code style="font-family: RobotoMono,monospace;">counter</code>ë¥¼ ì¦ê°€ì‹œí‚¤ëŠ” ë¶€ë¶„ì´ë¯€ë¡œ, ìŠ¤ë ˆë“œê°€ <code style="font-family: RobotoMono,monospace;">performThread</code>ì— ì§„ì…í•  ë•Œ lockí•´ ë‹¤ë¥¸ ìŠ¤ë ˆë“œê°€ ì§„ì…í•  ìˆ˜ ì—†ë„ë¡ ë§Œë“  í›„ ë‚˜ì˜¬ ë•ŒëŠ” unlockí•´ì£¼ë„ë¡ í–ˆë‹¤.</p><p style="font-size: 1rem; line-height: 1.7rem; margin-bottom: 1rem;"><img src="/images/50655470-a870ed80-0fd3-11e9-9917-b1fede3dcea0.webp"alt loading="lazy"decoding="async"width="356"height="429"style="max-width: 100%; height: auto; margin-bottom: -7px;"></p><p style="font-size: 1rem; line-height: 1.7rem; margin-bottom: 1rem;">ìµœì¢… ê°’ì€ 299999ì˜€ë‹¤. <code style="font-family: RobotoMono,monospace;">counter</code>ê°€ 0ì—ì„œ ì¶œë°œí•˜ë‹ˆê¹Œ ìµœì¢… ê°’ì´ 299999ì´ì–´ì•¼ ê° ìŠ¤ë ˆë“œê°€ 100000ë²ˆì”© ìˆ˜í–‰ë˜ì—ˆë‹¤ëŠ” ì˜ë¯¸ê°€ ëœë‹¤. ì˜ ë™ì‘í–ˆë‹¤.</p></section><section id="article-navigation"style="margin-top: 50px; overflow: hidden;"><div class="article-navigation-item article-navigation-next"style="margin-bottom: 1rem; text-align: left; float: left; margin-right: 5px;"><a href="17.html"style="color: #000; text-decoration: none; cursor: pointer;"><div class="article-navigation-arrow article-navigation-next symbol"style="font-family: Pretendard,sans-serif; font-size: .9rem; text-align: left; float: left; margin-right: 5px;">â†</div><div class="article-navigation-content article-navigation-next"style="text-align: left; float: left; margin-right: 5px;"><p class="article-navigation-title"style="font-weight: 700; font-size: 1rem; margin: 0;">Java Design Pattern: Singleton</p><p class="article-navigation-subtitle"style="font-weight: 400; font-size: .8rem; margin: 0;"></p></div></a></div><div class="article-navigation-item article-navigation-prev"style="margin-bottom: 1rem; text-align: right; float: right; margin-left: 5px;"><a href="15.html"style="color: #000; text-decoration: none; cursor: pointer;"><div class="article-navigation-arrow article-navigation-prev symbol"style="font-family: Pretendard,sans-serif; font-size: .9rem; text-align: right; float: right; margin-left: 5px;">â†’</div><div class="article-navigation-content article-navigation-prev"style="text-align: right; float: right; margin-left: 5px;"><p class="article-navigation-title"style="font-weight: 700; font-size: 1rem; margin: 0;">ğŸŒ ê°œë–¡ê°™ì€ ì½”ë“œì™€ í•¨ê»˜í•œ í•˜ë£¨ ë¦¬ë‰´ì–¼ ì´ì•¼ê¸°</p><p class="article-navigation-subtitle"style="font-weight: 400; font-size: .8rem; margin: 0;">ê±°ëŒ€í•œ ë ˆê±°ì‹œë¥¼ ìˆ˜ìŠµí•œ ê²½í—˜</p></div></a></div></section><section id="article-comments"><script async src="https://utteranc.es/client.js"repo="parksb/parksb.github.io-comments"issue-term="pathname"theme="github-light"crossorigin="anonymous"></script></section><div class="back-to-article-list"style="font-size: 1rem; margin-bottom: 1rem;"><a href="../articles.html"style="color: #000; text-decoration: none; cursor: pointer;"><span class="symbol"style="font-family: Pretendard,sans-serif;">â†</span> Articles</a></div></article></main><footer style="font-size: .8rem; color: #767676;">ì´ ê¸€ì€ CC BY-NC 4.0 ë¼ì´ì„ ìŠ¤ì— ë”°ë¼ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</footer><script async src="https://www.googletagmanager.com/gtag/js?id=G-LKTJ5YFJR2"></script><script>window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-LKTJ5YFJR2');</script></body></html>